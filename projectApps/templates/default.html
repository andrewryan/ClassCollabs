{% extends "base.html" %}
{% load static %}

{% block head %}
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="{% static "css/foundation.css" %}">
<link rel="stylesheet" href="{% static "css/app.css" %}">
{% endblock %}


{% block scripts %}
<script src="{% static "js/vendor/jquery.js" %}"></script>
<script src="{% static "js/vendor/what-input.js" %}"></script>
<script src="{% static "js/vendor/foundation.js" %}"></script>
<script src="{% static "js/app.js" %}"></script>
<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
<script>
  var socket = new WebSocket('ws://' + window.location.host + '/users/');

  // print to the console when the websocket has connected
  socket.onopen = function open() {
    console.log('websockets connection established.');
  };

  socket.onmessage = function message(event) {
    var data = JSON.parse(event.data);
    var username = encodeURI(data['username']);
    var user = $('li').filter(function () {
      return $(this).data('username') == username;
    });

    if (data['is_logged_in']) {
      user.html(username + ': Online');
    }
    else {
      user.html(username + ': ');
}
  };

  if (socket.readyState == WebSocket.OPEN) {
    socket.onopen();
  }
</script>
{% endblock %}
